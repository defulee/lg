<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>日志分析</title>
    <script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/jsoneditor/9.0.0/jsoneditor.min.js"></script>
    <link href="https://cdn.bootcdn.net/ajax/libs/jsoneditor/9.0.0/jsoneditor.min.css" rel="stylesheet">

    <link href="https://cdn.w3cbus.com/library/mdui/1.0.2/css/mdui.min.css" rel="stylesheet"/>
    <script src="https://cdn.w3cbus.com/library/mdui/1.0.2/js/mdui.min.js"></script>

    <link href="https://cdn.bootcdn.net/ajax/libs/jquery-treetable/3.2.0/css/jquery.treetable.min.css" rel="stylesheet">
    <link href="https://cdn.bootcdn.net/ajax/libs/jquery-treetable/3.2.0/css/jquery.treetable.theme.default.min.css" rel="stylesheet">
    <script src="https://cdn.bootcdn.net/ajax/libs/jquery-treetable/3.2.0/jquery.treetable.min.js"></script>

    <style>

         <!-- 左右分栏 start -->
        .column {
            overflow: hidden;
            display: flex;
            flex-direction: row;
        }
        .column-left {
            height: 100vh;
            background-color: #fff;
            position: relative;
            float: left;
        }
        .column-right {
            height: 100vh;
            background-color: #eee;
            box-sizing: border-box;
            overflow-x: hidden;
            position: relative;
            display: flex;
        }
        .resize-left {
            position: absolute;
            top: 0; right: 5px; bottom: 0; left: 0;
            padding: 16px;
            overflow-x: hidden;
        }
        .resize-bar {
            width: 50vw; height: inherit;
            resize: horizontal;
            cursor: ew-resize;
            cursor: col-resize;
            opacity: 0;
            overflow: scroll;
        }
        <!--/* 拖拽线 */-->
        .resize-line {
            position: absolute;
            right: 0; top: 0; bottom: 0;
            border-right: 5px solid #eee;
            border-left: 2px solid #bbb;
            pointer-events: none;
        }
        .resize-bar:hover ~ .resize-line,
        .resize-bar:active ~ .resize-line {
            border-left: 1px dashed skyblue;
        }
        .resize-bar::-webkit-scrollbar {
            width: 200px; height: inherit;
        }
        <!-- 左右分栏 end -->


        .mdui-tab-custom {
            position: fixed;
            height: 48px;
            width: 100%;
            z-index: 10;
            background-color: #eee;
        }

        .mdui-container {
            flex: 2 1 auto;
            display: flex;
            flex-direction: column;
        }
        .tabs-container {
            position: relative;
            height: 100%;
            border: 1px solid black;
            flex: 2 1 auto;
        }
        #treeTable tr {
            height: 32px !important;
        }
    </style>
</head>
<body>
    <div class="column">
        <div class="column-left">
            <div class="resize-bar"></div>
            <div class="resize-line"></div>
            <div class="resize-left">
                <div id="traceId"></div>
                <table id="treeTable" class="table table-striped table-bordered table-hover">
                    <thead>
                    <tr>
                        <th>类型</th>
                        <th style="display:none">traceId</th>
                        <th style="display:none">spanId</th>
                        <th>关键点</th>
                        <th>耗时</th>
                        <th>状态</th>
                        <th style="display:none">请求</th>
                        <th style="display:none">响应</th>
                        <th style="display:none">其他</th>
                    </tr>
                    </thead>
                    <tbody>
                        {{treetable_body}}
                    </tbody>
                </table>
            </div>


        </div>

        <div class="mdui-divider"></div>

        <div id="content-detail" class="column-right">
            <div class="mdui-container">
                <div class="mdui-tab mdui-tab-custom" mdui-tab>
                    <a href="#tab-request" class="mdui-ripple">请求</a>
                    <a href="#tab-response" class="mdui-ripple">响应</a>
                    <a href="#tab-content" class="mdui-ripple">其他</a>
                </div>

                <div id="tab-request" class="mdui-p-a-2 tab-content">
                    <div id="req-jsonEditor"></div>
                </div>
                <div id="tab-response" class="mdui-p-a-2 tab-content">
                    <div id="resp-jsonEditor"></div></div>
                <div id="tab-content" class="mdui-p-a-2 tab-content"></div>
            </div>

        </div>
    </div>


    <script>
        $('#treeTable').treetable({
            expandLevel : 2,
            expandable: true
        });

        // create the jsonEditor
        const reqJsonContainer = document.getElementById("req-jsonEditor")
        const respJsonContainer = document.getElementById("resp-jsonEditor")

        // 配置参数
        const options = {
            modes: ['text', 'code', 'tree', 'form', 'view'],
            mode:"view",
            // 只能是用户主动的修改才会触发，程序改变的情况下不会触发，比如set,setText,update,updateText
            onError(error){
                coonsole.log("发生了报错")
            },
            onValidate(json){
                // 每次修改json之后应该判断一下数据结构是否是正确的
                var errors=[]
                if(json&&json.params){
                    console.log("json格式化正确")
                } else{
                    console.log('json格式化失败')
                }
            },
            history:false,
            mainMenuBar:true,
            navigationBar:true,
            statusBar:false,
        }
        const reqJsonEditor = new JSONEditor(reqJsonContainer, options)
        const respJsonEditor = new JSONEditor(respJsonContainer, options)

        // Highlight selected row
        $("#treeTable tbody").on("mousedown", "tr", function() {
            $(".selected").not(this).removeClass("selected");
            $(this).toggleClass("selected");

            const req = this.children[6].innerText
            if (req != '') {
                jsonData = JSON.parse(req);
                reqJsonEditor.set(jsonData)
            } else {
                reqJsonEditor.set({})
            }
            reqJsonEditor.expandAll()

            const resp = this.children[7].innerText
            if (resp != '') {
                jsonData = JSON.parse(resp);
                respJsonEditor.set(jsonData)
            } else {
                respJsonEditor.set({})
            }
            respJsonEditor.expandAll()

            const tabContent = document.getElementById("tab-content")
            tabContent.innerText = this.children[8].innerText

            // const traceId = document.getElementById("traceId")
            // traceId.innerText = 'traceId: ' + this.children[1].innerText + ', spanId: ' + this.children[2].innerText

        });
    </script>

</body>
</html>